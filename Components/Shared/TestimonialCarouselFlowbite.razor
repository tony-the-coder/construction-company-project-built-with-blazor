@* File: Components/Public/Shared/TestimonialCarouselFlowbite.razor *@

@* Inject services if needed later for real data *@
@* @inject ITestimonialService TestimonialService *@

@if (testimonials == null || !testimonials.Any())
{
    @* Don't render anything if there are no testimonials, or show a placeholder *@
    @* <p>No testimonials available.</p> *@
}
else
{
    <section aria-labelledby="testimonial-heading" class="bg-white dark:bg-gray-900 py-12 sm:py-16">
        <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8">
            @* Optional Section Heading *@
            <div class="text-center mb-10">
                <h2 id="testimonial-heading" class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
                    What Our Clients Say
                </h2>
                @* Optional subheading can go here *@
            </div>

            @* --- Flowbite Carousel Structure --- *@
            <div id="testimonial-carousel-@_uniqueId" class="relative w-full" data-carousel="slide">
                <!-- Carousel wrapper -->
                <div class="relative h-64 overflow-hidden rounded-lg md:h-96 shadow-lg">
                    @* Adjusted height & added shadow *@
                    @foreach (var (testimonial, index) in testimonials.Select((item, idx) => (item, idx)))
                    {
                        <div class="@(index == 0 ? "" : "hidden") duration-700 ease-in-out" data-carousel-item>
                            @* First item visible initially *@
                            <div class="absolute inset-0 flex bg-gray-50 dark:bg-gray-800">
                                @* Slide background *@
                                <!-- Text Content (Left 40%) -->
                                <div class="w-full md:w-2/5 flex items-center justify-center bg-gradient-to-r from-white via-gray-50 to-gray-100 dark:from-gray-800 dark:via-gray-800 dark:to-gray-700 p-6 md:p-10">
                                    <div class="text-gray-700 dark:text-gray-300 text-center md:text-left">
                                        <svg class="w-10 h-10 text-gray-400 dark:text-gray-600 mb-4" aria-hidden="true" fill="currentColor" viewBox="0 0 18 14">
                                            <path d="M6 0H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v1a3 3 0 0 1-3 3H2a1 1 0 0 0 0 2h1a5.006 5.006 0 0 0 5-5V2a2 2 0 0 0-2-2Zm10 0h-4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v1a3 3 0 0 1-3 3h-1a1 1 0 0 0 0 2h1a5.006 5.006 0 0 0 5-5V2a2 2 0 0 0-2-2Z" />
                                        </svg>
                                        <p class="text-lg md:text-xl font-medium italic mb-4">"@testimonial.Quote"</p>
                                        <p class="font-semibold text-gray-900 dark:text-white">@testimonial.AuthorName</p>
                                        @if (!string.IsNullOrWhiteSpace(testimonial.ProjectDescription))
                                        {
                                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">@testimonial.ProjectDescription</p>
                                        }
                                    </div>
                                </div>
                                <!-- Image Content (Right 60%) -->
                                <div class="hidden md:block md:w-3/5">
                                    @if (!string.IsNullOrWhiteSpace(testimonial.ImageUrl))
                                    {
                                        <img src="@testimonial.ImageUrl" class="w-full h-full object-cover" alt="Testimonial related image for @testimonial.AuthorName">
                                    }
                                    else
                                    {
                                        @* Placeholder for when image is missing *@
                                        <div class="w-full h-full bg-gradient-to-r from-gray-100 to-gray-300 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center">
                                            <span class="text-gray-400 dark:text-gray-500 text-sm">(Project Image)</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Slider indicators -->
                <div class="absolute z-30 flex -translate-x-1/2 bottom-5 left-1/2 space-x-3 rtl:space-x-reverse">
                    @for (int i = 0; i < testimonials.Count; i++)
                    {
                        <button type="button" class="w-3 h-3 rounded-full bg-gray-400 dark:bg-gray-600 hover:bg-gray-900 dark:hover:bg-white" aria-current="@(i == 0 ? "true" : "false")" aria-label="Slide @(i + 1)" data-carousel-slide-to="@i"></button>
                    }
                </div>

                <!-- Slider controls -->
                <button type="button" class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-prev>
                    <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                        <svg class="w-4 h-4 text-gray-800 dark:text-white rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4" />
                        </svg>
                        <span class="sr-only">Previous</span>
                    </span>
                </button>
                <button type="button" class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-next>
                    <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                        <svg class="w-4 h-4 text-gray-800 dark:text-white rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4" />
                        </svg>
                        <span class="sr-only">Next</span>
                    </span>
                </button>
            </div>
            @* --- End Flowbite Carousel --- *@
        </div>
    </section>
}


@code {
    private List<Testimonial> testimonials = new();
    private string _uniqueId = Guid.NewGuid().ToString("N"); // Unique ID for carousel instance

    // Class to hold testimonial data (add ImageUrl)
    private class Testimonial
    {
        public string Quote { get; set; } = "";
        public string AuthorName { get; set; } = "";
        public string? ProjectDescription { get; set; } // Optional e.g., "Mountain Retreat"
        public string? ImageUrl { get; set; } // Optional image URL
    }

    protected override void OnInitialized()
    {
        // Replace with actual data fetching later
        LoadSampleTestimonials();
        base.OnInitialized();
    }

    // Sample data (ADD IMAGE URLs HERE)
    private void LoadSampleTestimonials()
    {
        testimonials = new List<Testimonial> {
             new Testimonial {
                 Quote = "From the initial design discussions to the final walkthrough, Lehman Custom Construction exceeded every expectation. Their attention to detail is unparalleled.",
                 AuthorName = "Sarah & Tom P.",
                 ProjectDescription = "Lakefront Modern Home",
                 ImageUrl = "/images/placeholders/testimonial-01.jpg" // Use your actual image paths
             },
             new Testimonial {
                 Quote = "The team's professionalism and communication were outstanding throughout our major renovation. We felt informed and involved every step of the way.",
                 AuthorName = "Michael B.",
                 ProjectDescription = "Historic Downtown Renovation",
                 ImageUrl = "/images/placeholders/testimonial-02.jpg"
             },
             new Testimonial {
                 Quote = "Lehman didn't just build us a house; they crafted our dream home. The quality of workmanship is evident in every corner.",
                 AuthorName = "Emily R.",
                 ProjectDescription = "Custom Farmhouse Build",
                 ImageUrl = null // Example without image
             },
              new Testimonial {
                 Quote = "They handled unexpected challenges with expertise and grace, keeping the project on track. We couldn't be happier with the result.",
                 AuthorName = "David & Lisa G.",
                 ProjectDescription = "Complex Hillside Construction",
                 ImageUrl = "/images/placeholders/testimonial-03.jpg"
             }
         };
    }

    // NOTE: Flowbite JS initialization via data attributes should work automatically
    // if Flowbite JS is loaded globally in App.razor or _Layout.cshtml/_Host.cshtml.
    // No JSInterop needed for basic functionality.
}